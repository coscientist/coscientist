---
title: "2026-01-19"
description: "Fix locale navigation, refine header actions, and optimize manifesto note loading"
---

## Manifesto Locale Navigation Fix

**Scope**: `apps/web`

### Changes Made

| File | Change |
| ---- | ------ |
| `src/lib/use-note-stack.ts` | Switched to the next-intl router to generate locale-aware stack URLs and avoid hard reloads on non-English note clicks. |

### Technical Decisions

1. **Locale-aware Router**: Use `@/i18n/navigation`'s `useRouter` so stack URL updates respect locale prefixes and sync cookies, preventing full reloads.

### Verification

- TypeScript: Not run (not requested)
- Build: Not run (not requested)
- Tests: Not run (not requested)

### Next Steps

None.

## Manifesto Note Loading Optimization

**Scope**: `apps/web`

### Changes Made

| File | Change |
| ---- | ------ |
| `src/lib/notes/markdown-parser.ts` | Added a lightweight frontmatter parser to avoid HTML work when building the note graph. |
| `src/lib/notes/note-loader.ts` | Split full note loading from graph-node loading, cached graph nodes, and removed outbound link parsing from full notes. |
| `src/lib/notes/graph-builder.ts` | Built backlinks from lightweight nodes and returned summary-only note maps. |
| `src/lib/notes/index.ts` | Wrapped note graph construction in React cache for per-request dedupe. |
| `src/lib/types.ts` | Split note types into graph nodes vs. full notes and removed unused inbound/outbound link fields. |
| `src/app/[locale]/manifesto/[[...slug]]/page.tsx` | Wired search params into the server wrapper to drive stack rendering from the URL. |
| `src/app/[locale]/manifesto/[[...slug]]/client-wrapper.tsx` | Loaded full note content only for the active stack and parallelized note graph + pane fetches. |
| `src/app/[locale]/manifesto/[[...slug]]/client-wrapper.tsx` | Switched pane construction to a reduce-based build to avoid nullable type predicates. |
| `src/components/client/index.tsx` | Renamed pane data props to reflect stack-only payloads. |
| `src/components/client/pane-orchestrator.tsx` | Guarded close behavior when stack updates ahead of pane data and aligned stack insertion with visible panes. |
| `src/components/client/mobile-orchestrator.tsx` | Matched close behavior to available panes for mobile stack updates. |
| `src/components/pane/container.tsx` | Updated mobile orchestration to consume stack-only pane data. |

### Technical Decisions

1. **Stack-only payloads**: Only send HTML for panes in the active stack while leaving summaries global, relying on nuqs-driven URL updates to re-render panes via RSC.
2. **Lightweight graph parsing**: Use frontmatter-only parsing for backlink construction to avoid repeated HTML transforms.
3. **Cache graph work**: Wrap graph construction in React cache to dedupe per request.

### Verification

- TypeScript: Pass
- Build: Pass
- Tests: Not run (not requested)

### Next Steps

None.

## Hugeicons Dependency Install

**Scope**: `apps/web`

### Changes Made

| File | Change |
| ---- | ------ |
| `package.json` | Added `@hugeicons/react` and `@hugeicons/core-free-icons` dependencies. |
| `bun.lock` | Updated lockfile for Hugeicons packages. |
| `AGENTS.md` | Documented Hugeicons in the tech stack. |

### Technical Decisions

1. **Icon system alignment**: Install the Hugeicons packages referenced by UI components to keep icon usage consistent and type-safe.

### Verification

- TypeScript: Pass
- Build: Pass
- Tests: Not run (not requested)

### Next Steps

None.

## Header Actions Mobile Optimization

**Scope**: `apps/web`

### Changes Made

| File | Change |
| ---- | ------ |
| `src/components/layout/app-header.tsx` | Added a compact icon-only waitlist action on mobile while keeping the full label on larger screens. |

### Technical Decisions

1. **Responsive CTA Swap**: Use Tailwind breakpoints to swap the waitlist button between text and icon-only versions without adding new translation keys.

### Verification

- TypeScript: Not run (not requested)
- Build: Not run (not requested)
- Tests: Not run (not requested)

### Next Steps

None.

## Header Mobile Sheet

**Scope**: `apps/web`

### Changes Made

| File | Change |
| ---- | ------ |
| `src/components/layout/app-header.tsx` | Replaced the mobile header button group with a hamburger-triggered bottom sheet including waitlist, GitHub, language, and theme controls. |
| `src/components/language-switcher.tsx` | Exported locale name mappings to reuse in the mobile sheet without duplicating copy. |

### Technical Decisions

1. **Sheet-based Actions**: Use Base UI `Sheet` from the bottom to keep mobile actions accessible with larger targets.

### Verification

- TypeScript: Not run (not requested)
- Build: Not run (not requested)
- Tests: Not run (not requested)

### Next Steps

None.

## Hugeicons Migration

**Scope**: `apps/web`

### Changes Made

| File | Change |
| ---- | ------ |
| `next.config.ts` | Swapped icon transpilation to Hugeicons packages. |
| `package.json` | Replaced Nucleo dependency with Hugeicons packages. |
| `src/components/**` | Replaced Nucleo/Lucide icon usage with HugeiconsIcon and free icon set. |
| `AGENTS.md` | Updated icon guidelines to standardize on Hugeicons. |

### Technical Decisions

1. **Single Icon System**: Standardize all UI icons on Hugeicons to avoid mixed icon styles.

### Verification

- TypeScript: Not run (not requested)
- Build: Not run (not requested)
- Tests: Not run (not requested)

### Next Steps

None.

## Manifesto Korean Style Pass

**Scope**: `apps/web`

### Changes Made

| File | Change |
| ---- | ------ |
| `src/content/manifesto/ko/*.md` | Rewrote Korean manifesto entries for an academic, assertive tone and standardized core terminology (e.g., 책임선, 증거 구간, 다국어 지식 메쉬). |

### Technical Decisions

1. **Tone normalization**: Shifted Korean manifesto prose to an assertive, academic declarative style and removed colloquial hedging.
2. **Terminology alignment**: Standardized key glossary terms across notes to reduce internal inconsistency.

### Verification

- TypeScript: Not run (content-only changes)
- Build: Not run (not requested)
- Tests: Not run (not requested)

### Next Steps

None.

## Update GitHub Link & Docs

**Scope**: `apps/web`

### Changes Made

| File | Change |
| ---- | ------ |
| `src/components/layout/app-header.tsx` | Updated GitHub button in mobile drawer to show "opens in new tab" text and external link icon. |
| `AGENTS.md` | Added documentation for the Nested Sheet Pattern. |

### Technical Decisions

1. **Explicit External Link Indicator**: Added text and icon to clearly indicate the GitHub link opens outside the app, improving UX/accessibility.
2. **Documentation**: Documented the nested sheet pattern to ensure consistent implementation of drill-down menus.

### Verification

- TypeScript: Pass
- Build: Pass
- Tests: Not run (not requested)

### Next Steps

None.
